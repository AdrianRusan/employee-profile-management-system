// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String            @id @default(cuid())
  email              String            @unique
  name               String
  role               Role              @default(EMPLOYEE)
  department         String?
  title              String?
  bio                String?
  avatar             String?
  salary             Decimal?
  ssn                String?
  address            String?
  performanceRating  Int?
  deletedAt          DateTime?
  feedbackGiven      Feedback[]        @relation("FeedbackGiver")
  feedbackReceived   Feedback[]        @relation("FeedbackReceiver")
  absenceRequests    AbsenceRequest[]
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@index([email])
  @@index([department])
  @@index([role])
  @@index([department, role])
  @@index([performanceRating])
  @@index([deletedAt])
}

model Feedback {
  id              String   @id @default(cuid())
  content         String
  polishedContent String?
  isPolished      Boolean  @default(false)
  giver           User     @relation("FeedbackGiver", fields: [giverId], references: [id], onDelete: Cascade)
  giverId         String
  receiver        User     @relation("FeedbackReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  receiverId      String
  deletedAt       DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([receiverId, createdAt(sort: Desc)])
  @@index([giverId])
  @@index([giverId, createdAt(sort: Desc)])
  @@index([isPolished])
  @@index([receiverId, isPolished])
  @@index([deletedAt])
  @@index([receiverId, createdAt(sort: Desc), deletedAt])
}

model AbsenceRequest {
  id        String        @id @default(cuid())
  startDate DateTime
  endDate   DateTime
  reason    String
  status    AbsenceStatus @default(PENDING)
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  deletedAt DateTime?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([userId])
  @@index([status])
  @@index([userId, status])
  @@index([startDate, endDate])
  @@index([status, startDate])
  @@index([deletedAt])
  @@index([userId, deletedAt])
}

enum Role {
  EMPLOYEE
  MANAGER
  COWORKER
}

enum AbsenceStatus {
  PENDING
  APPROVED
  REJECTED
}
